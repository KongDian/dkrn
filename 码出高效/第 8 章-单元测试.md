# 第 8 章 单元测试

软件产品通常是由模块组合而成，模块又可以分成诸多子模块。最终的子模块是由不可再分的程序单元组成。对于这些程序单元的测试，即称为单元测试（Unit Testing，简称单元测试）。在面向对象编程中，通常认为最小单元就是方法。

单元测试的好处包括但不限于以下几点：

1. 提升软件质量
2. 促进代码优化
3. 增加重构自信
4. 提升研发效率

## 8.1 单元测试的基本原则

宏观上，单元测试要符合 AIR 原则；微观上，单元测试的代码层面要符合 BCDE 原则。

AIR 原则具体包括：

- A：Automatic（自动化）
- I：Independent（独立性）
- R：Repeatable（可重复）

单元测试应该是自动执行的。

为了保证单元测试稳定可靠便于维护，需要保证其独立性。用例之间不允许相互调用，也不允许出现执行次序的先后依赖。JUnit 的用例执行顺序是无序的，而 TestNG 支持测试用例的顺序执行（默认测试类内部各测试用例是按字典升序执行的，也可以通过 XML或 注解 priority 的方式来配置执行顺序）。

单元测试是可以重复执行的，不能受到外界环境的影响。

编写单元测试时要保证测试粒度要足够小。

编写单元测试用例时需要符合 BCDE 原则。

- B：Border，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。
- C：Correct，正确的输入，并得到预期结果。
- D：Design，与设计文档结合，来编写单元测试。
- E：Error，单元测试的目标时证明程序有错，而不是程序无措。

由于单元测试只是系统集成测试前的小模块测试，有些因素往往不具备，因此需要进行 Mock，例如：

（1）功能因素。比如单元测试方法内部调用功能不可用。

（2）时间因素。与时间相关的功能点。

（3）环境因素。政策环境，多端环境。

（4）数据因素。数据样本过小。

（5）其他因素。

最简单的 Mock 方式是硬编码，更优雅的方式是使用配置文件，最佳的方式是使用 Mock 框架，如 JMock、EasyMock、JMock等。



## 8.2 单元测试覆盖率

